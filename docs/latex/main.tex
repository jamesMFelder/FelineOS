% SPDX-License-Identifier: MIT
% Copyright (c) 2021 James McNaughton Felder
\documentclass[12pt]{article}
\usepackage[T1]{fontenc}
\usepackage{xcolor}
\definecolor{light-gray}{gray}{0.95}
\newcommand{\code}[1]{\colorbox{light-gray}{\texttt{#1}}}

\title{Feline OS Documentation}

\begin{document}

\begin{center}
\fontsize{25}{35}
\selectfont
\textbf{Feline OS Documentation}
\end{center}

\section{Overview}
\begin{list}{}{}
\item This is my hobby OS, don't expect anything professional.
\item I don't have a cross compiler with this because that would lock it to my type of machine.
\begin{tiny} The real reason is my distribution has one as a package.\end{tiny}

\end{list}

\section{Structure of the Code}
\begin{list}{}{}
\item \code{docs/}: Documentation
\item \code{docs/latex/}: Original latex documentation.
\item \code{docs/\{html,pdf\}/}: Generated documentation.
\item \code{kernel/}: The kernel.
\item \code{kernel/arch/}: Architecture dependent stuff in the kernel.
\item \code{kernel/arch/i386/}: 32-bit PC stuff
\item \code{kernel/arch/\$(ARCH)/}:
\item \code{kernel/arch/\$(ARCH)/boot/}: the early boot process
\item \code{kernel/arch/\$(ARCH)/gdt/}: dealing with the Global Descriptor Table \begin{small}(mostly creating the illusion of disabling it)\end{small}
\item \code{kernel/arch/\$(ARCH)/interrupts/}: handling interrupts
\item \code{kernel/arch/\$(ARCH)/mem/}: managing physical memory
\item \code{kernel/arch/\$(ARCH)/screen/}: hardware output
\item \code{kernel/drivers/}: Stuff that one might or might not want
\item \code{kernel/drivers/include/}: Header files for the drivers
\item \code{kernel/drivers/include/drivers/}: \code{<drivers/header.h>} instead of \code{<header.h>}
\item \code{kernel/drivers/serial/}: Code for the serial port
\item \code{kernel/include/}: Kernel headers
\item \code{kernel/include/kernel/}: \code{<kernel/header.h>} instead of \code{<header.h>}
\item \code{kernel/kernel/}: Generic kernel files.
\item \code{libc/}: A minimal C library
\item \code{libc/arch/}: Architecture dependent libc stuff (macros, â€¦)
\item \code{libc/arch/i386/}: 32-bit PC stuff
\item \code{libc/include/}: Header files.
\item \code{libc/include/sys/}: System header files.
\item \code{libc/ctype/}: Detecting character types.
\item \code{libc/ssp/}: What gcc needs to detect stack smashing.
\item \code{libc/stdio/}: I/O programs.
\item \code{libc/stdlib/}: Other C library programs.
\item \code{libc/string/}: C String handling programs.
\item \code{utils/}: Programs to run outside the OS
\end{list}

\section{Documentation}
\begin{list}{}{}
\item \code{docs/latex} contains the latex documentation
\item Running \code{./docs.sh} creates documentation in \code{docs/\{pdf,html\}} if you have \code{pdflatex} and \code{latex2html} installed.
\item I try to comment in the code, but I often forget.
\end{list}

\section{Usefull Commands}
\begin{list}{}{}
\item \code{./default-host.sh}: Echo the architecture we are building for.
\item \code{./config.sh}: Define a bunch of variables.
\item \code{./headers.sh}: Copy headers into their correct places.
\item \code{./build.sh}: Compile FelineOS.\@
\item \code{./iso.sh}: Create an iso.
\item \code{./qemu.sh}: Run the iso in qemu.
\item \code{./docs.sh}: Create the pdf and html documentation.
\item \code{./clean.sh}: Clean up everything.
\end{list}

\section{Usefull Programs}
\begin{list}{}{}
\item \code{utils/gdt\_create.c}: The main function calls \code{create\_descriptor(base, limit, type)}. The only defined types (currently) are \code{\{code,data\}-ring\{0,3\}}.
\item \code{utils/sizes.c}: Print the sizes of various types. Use \code{-{}-json} if wanted.
\end{list}

\section{Memory management}
\begin{list}{}{}
\item The PMM currently has a stack of pages it hands out. It has no safeguards to prevent anything (freeing free memory = handing out memory twice, freeing other processes memory, \ldots) other than underflowing the stack.
\item Get a free page (4 kilobytes) with \code{void *get\_mem\_area()} and free it with \code{int free\_mem\_area(void *loc)}.
\item \code{get\_mem\_area()} returns a pointer to the begining of the memory. \code{free\_mem\_area()} returns 0 on sucess, anything else on failure (note that there are no failure conditions yet, but please check).
\end{list}

\section{IO}
\begin{list}{}{}
\item Currently all standard output functions (\code{printf()}, \code{puts()}, \code{putchar()}, \ldots) all output to the screen (\code{terminal\_writestring()}, \code{terminal\_write()}, \code{terminal\_putchar()}) and serial port (\code{serial\_writestring()}, \code{serial\_write()}, \code{serial\_putchar()}).\linebreak
\begin{list}{}{}
\item Please only use standard output functions (\code{printf}, \code{puts}, \code{putchar}, \ldots). I make no garantees about supporting any other functions.
\end{list}
\item There is no input (yet).
\end{list}

\end{document}
